---
layout: post
title: 操作系统结构学习笔记
date: 2018-09-17
categories: 技术
---

**前言**

> 目前操作系统主要包括window，Unix，Linux三种内核；而我学习操作系统的目的是希望能够对操作系统的结构和整体的执行流程有一定的了解

### 概述

* 操作系统定义：控制和管理整个计算机系统的硬件和软件资源

* 计算机基本构成
 `处理器，内存，输入输出模块，系统总线`

* 操作系统功能和目标
    - 方便
    - 有效
    - 扩展能力

* 操作系统特征 
    - 并发
    - 共享
    - 异步
    - 虚拟 

* 操作系统分类
    - 单道批处理系统
    - 多道批处理系统
    - 分时系统
    - 实时系统
    - 网络与分布式系统

### 进程

> 进程：由一组执行的指令，一个当前状态和一组相关的系统资源表征的活动单元；是正在执行的，争夺CPU时间和其他系统资源的程序

##### 进程的特征

  * `结构性`--进程实体是由相关的程序段，相关的数据或存放这些数据的地址和PCB三部分组成
  * `动态性`--进程的实质是进程实体的一次执行过程
  * `并发性`--指多个进程实体同时存放在内存中，并在一段时间内同时执行
  * `独立性`--进程实体是一个独立运行，独立分配系统资源和独立接受操作系统调度的基本单元
  * `异步性`--进程会以不可预知的速度进行推进，因为不同进程有不同的优先级别

##### 进程状态说明

  * `运行态`
  * `就绪态`
  * `阻塞态/等待态`
  * `新建态`
  * `退出态`

##### 进程状态转换

  * 空  ->新建
  * 新建->就绪
  * 就绪->运行
  * 运行->退出
  * 运行->就绪
  * 运行->阻塞
  * 阻塞->就绪
  * 就绪->退出
  * 阻塞->退出 

<font style="color: red">进程进入挂起状态的作用</font>：

  * **什么是进程挂起？**将内存中某个进程的一部分或全部已到磁盘中，换出到磁盘中的挂起队列
  * **什么情况下需要进行进程挂起**
    1. 操作系统需要交换获取足够的内存空间
    2. 挂起后台进程或工具程序进程，或者可能会导致问题的进程
    3. 交互式用户请求
    4. 记账或系统监视进程，需要被周期性执行
    5. 父进程请求

  * **如何进行进程挂起？**将进程状态置为挂起状态并将进程数据换出到磁盘   

##### 进程控制块

> 进程控制块：用于描述和管理进程的相关信息

进程控制块内容：

  * 进程标识符
  * 处理机状态信息
  * 进程调度信息
  * 进程控制信息
  * 存储管理信息


<font style="color: red">进程控制块的组织方式</font>：

  * 链接方式
  * PCB索引方式

##### 如何创建进程

1. 系统将所有CPU寄存器内容保存在调用程序PCB的寄存器保护区
2.  操作系统查询空闲PCB链表，并读取一个空闲PCB
3. 操作系统为新进程pid复制并更新空闲的PCB编号
4. 操作系统获取子程序文件在磁盘上的位置，该文件的大小和第一个可执行指令的位置
5. 操作系统分配存储单元并进行装载
6. 初始化进程信息
7. 将进程PCB链接到准备就绪的进程链表中
8. 更新进程总清单

##### 进程调度方式

  * **非抢占方式**：让进程运行到结束或堵塞的调度方式，适合于专用系统
  * **抢占方式**：允许将逻辑上可继续运行的在运行过程暂停的方式

##### 进程同步与互斥

  * **进程同步**：指多个进程在特定点会合或者握手使得达成协议或者使得操作序列有序
  * **互斥**：互斥是一种逻辑关系，指几个变量或事件之中的任一个不可能与其它一个或多个同时为真，或同时发生的情况 
  * **临界资源**：一次仅允许一个进程访问的资源就是临界资源
  * **临界区**：将每个进程中访问临界资源的代码段称为临界区
  * **信号量机制**：信号量机制即利用pv操作来对信号量进行处理

##### 进程通信

> 指进程间的信息交换，包括两种通信方式：基于共享数据结构的通信方式和机遇共享存储区的通信方式

##### 线程

> 线程是一个可调度和分派的基本单位，还是一个可以独立运行的实体；单个进程内的线程可并发执行且共享该进程的资源

  * 线程的属性
    * 轻型实体-基本不拥有系统资源
    * 独立调度和分派的基本单位，切换迅速
    * 可并发执行
    * 共享进程资源


  * 进程和线程的区别

> 进程是系统进行资源分配和调度的一个独立单位，而线程则是CPU调度和分派的基本单位；线程不拥有系统资源，而是与同属一个进程的其他的线程共享进程所拥有的全部资源  

### 内存

##### 为什么需要进行内存管理？

如果只有少量进程在内存中，那么所有进程大部分时间都用来等待I/O，这种情况下处理器也处于空闲状态，因此有效地分配内存可以保证适量的就绪进程占用处理器时间

##### 内存管理

> 内存管理主要指操作系统对内存的划分和动态分配，内存管理的功能

1. 内存空间的分配与回收
2. 地址转换
3. 内存空间的扩充
4. 存储保护

##### 固定分区

> 在系统生成阶段，内存被划分成许多静态分区，进程可以装入大于等于自身大小的分区中

>这种分区方式存在两个问题：一是程序可能太大而放不进任何一个分区中，这时用户不得不使用覆盖技术来使用内存空间；二是主存利用率低，当程序小于固定分区大小时，也占用了一个完整的内存分区空间，这样分区内部有空间浪费，这种现象称为<span style="color: red">内部碎片</span>。

##### 动态分区

> 分区是动态创建的，因而每个进程可装入与自身大小正好相等的分区中

>动态分区在开始分配时是很好的，但是之后会导致内存中出现许多小的内存块。随着时间的推移，内存中会产生越来越多的碎片，内存的利用率随之下降;这种现象称为<span style="color: red">外部碎片</span>

* 如何解决外部碎片？
  * 利用非连续性内存的分配
  * 使用有效方式监控内存分配，保证大块内存的连续性和完整性

* 动态分区的分配策略
  * 最佳适配：选择和要求大小最接近的块
  * 首次适配：从头开始扫描内存，选择大小足够的第一个可用块
  * 下次适配：从上次结束位置开始扫描内存，选择大小足够的第一个可用块

   ><span style="color: red">置换算法</span>：
   内存内所有进程处于阻塞态，且新进程没有足够内存空间，为避免等待活动进程解除阻塞状态引起的处理器时间浪费，操作系统可将阻塞进程置换出内存

   ><span style="color: red">伙伴系统</span>：最小的内存块来满足内核的对于内存的请求


​    
##### 分页

> 内存被划分为大小相等的页框，进程则被划分为大小和页框相等的页；装入进程则是将进程页装入不一定连续的页框中

><span style="color: red">引入分页技术原因</span>：
>固定分区会产生内部碎片，动态分区会产生外部碎片，这两种技术对内存的利用率都比较低

基本概念：
* `页` - 进程中的块称为页
* `页号` - 内存中的块称为页框
* `地址结构` - 指分页存储管理的逻辑地址结构，地址结构包含两部分：前一部分为页号P，后一部分为页内偏移量W
* `页表` - 为了便于在内存中找到进程的每个页面所对应的物理块，系统为每个进程建立一张页表，记录页面在内存中对应的物理块号，页表一般存放在内存中

><span style="color: red">地址变换机构(转换检测缓冲区)</span>：进行逻辑地址到物理地址的转换;可通过快表的方式加快变换的过程

><span style="color: red">两级页表</span>：通过两级页表的方式降低页表大小，提高内存利用率

##### 分段

> 每个进程被划分为许多段，装入进程则是将进程段装入不一定连续的某些动态分区中；有利于实现保护和共享机制

 >注意：在一个进程中，段表只有一个，而页表可能有多个

##### 虚拟内存

* 读取策略
* 放置策略
* 置换策略

  置换策略算法
  * 最佳算法 - 选取下次访问时间距离当前时间最长的页(需要预测，无法实现)
  * 最近最少使用算法 - 置换内存内最长时间未被访问的页
  * 先进先出算法 - 置换再内存内停留时间最长的页，易造成<span style="color: red">缺页中断</span>
  * 时钟算法
* 驻留集管理
* 清除策略
* 加载控制
  


* 其他
  * 程序链接方式：
     1. 静态链接
     2. 装入时动态链接
     3. 运行时动态链接
  * 如何扩充内存？
  * 分页技术和分段技术的区别

     页管理方式是从计算机的角度考虑设计的，以提高内存的利用率，提升计算机的性能, 且分页通过硬件机制实现，对用户完全透明；而分段管理方式的提出则是考虑了用户和程序员，以满足方便编程、信息保护和共享、动态增长及动态链接等多方面的需要
     
   * 局部性原理  

### 调度管理

* 调度类型
  * `长程调度` -- 决定加入待执行线程池
  * `中程调度` -- 决定加入部分或全部位于内存的线程集合
  * `短程调度` -- 决定处理器执行哪个可运行进程
  * `I/O调度` -- 决定可用IO设备执行哪个进程的IO请求
* 调度算法
* 多处理器调度

###  设备管理

##### 设备管理功能

* 进行设备的分配
* 实现IO操作

##### 设备控制器功能

* 接收和识别命令
* 数据交换
* 标识和报告设备状态
* 地址识别
* 数据缓冲
* 差错控制

##### IO控制方式

* 程序直接控制方式
* 中断控制方式
* DMA控制方式
* 通道控制方式

##### 中断技术

##### 缓冲技术

### 文件管理

##### 文件

> 文件是具有标识符的一组相关信息的集合

1. 文件逻辑结构
   * 有结构文件
   * 无结构文件
2. 文件物理结构
   * 顺序结构存储
   * 链式结构存储
   * 索引结构存储
3. 文件存取方式
   * 顺序存取
   * 直接存取
   * 索引存取
4. 文件存储设备
   * 顺序存储
   * 直接存储
5. 文件共享和保护

### 文件系统

> 文件系统主要实现对文件存储器空间的组织和分配，以及对文件的存储和检索

1. 文件存储空间管理
2. 文件目录管理



参考书籍：“[操作系统精髓与设计原理](https://book.douban.com/subject/5064311/)”